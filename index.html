<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Feliz cumplea√±os Camila ‚ú∞</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

  body, html {
    margin: 0; padding: 0; width: 100%; height: 100%;
    overflow: hidden; background-color: #FEF4EA;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-family: 'Courier Prime', monospace;
    -webkit-text-size-adjust: 100%;
  }

  /* MAQUINA DE ESCRIBIR */
  .contenedor-maquina { margin-bottom: 20px; min-height: 40px; text-align: center; width: 100%; }
  .maquina-escribir {
    position: relative; display: inline-block; font-size: 22px; font-weight: bold; color: #5a3e2b; white-space: nowrap;
  }
  .maquina-escribir::after {
    content: ""; position: absolute; top: 0; right: 0; width: 100%; height: 100%;
    background-color: #FEF4EA; border-left: 3px solid #5a3e2b;
    animation: revelar 2.5s steps(35) forwards, parpadeoCursor 0.8s step-end infinite;
  }
  @keyframes revelar { from { width: 100%; } to { width: 0%; } }
  @keyframes parpadeoCursor { from, to { border-color: transparent; } 50% { border-color: #5a3e2b; } }

  /* CAJA */
  .caja-regalo { position: relative; height: 70vh; display: inline-block; cursor: pointer; z-index: 5; }
  .caja-regalo.cerrada { animation: brilloMagico 2s infinite ease-in-out; }
  @keyframes brilloMagico {
    0%, 100% { filter: drop-shadow(0 0 10px #FFD700); }
    50% { filter: drop-shadow(0 0 30px #FF8C00); }
  }
  .caja-regalo img#imagenCaja { height: 100%; width: auto; display: block; position: relative; z-index: 10; }

  /* CARTAS - DINAMISMO DE Z-INDEX */
  .cartas-container {
    position: absolute; top: 48%; left: 50%; transform: translate(-50%, -50%);
    width: 75%; height: 45%; display: none; 
    z-index: 20; /* Por defecto m√°s alto que la caja al abrirse */
  }

  @keyframes flotarIntenso {
    0%, 100% { transform: translateY(0) rotate(var(--rot-orig)); }
    50% { transform: translateY(-15px) rotate(var(--rot-orig)); }
  }

  .grupo-carta { 
    position: absolute; 
    width: 28%; 
    cursor: pointer; 
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    animation: flotarIntenso 2.5s infinite ease-in-out;
  }

  .grupo-carta:hover {
    transform: scale(1.3) rotate(-3deg) translateY(-40px) !important;
    z-index: 100;
    filter: drop-shadow(0 20px 25px rgba(0,0,0,0.4)) brightness(1.1);
    animation-play-state: paused;
  }

  .pos1 { left: 5%;  top: 5%;  --rot-orig: -12deg; transform: rotate(-12deg); } 
  .pos2 { left: 35%; top: 0%;  --rot-orig: 0deg;   } 
  .pos3 { left: 65%; top: 5%;  --rot-orig: 12deg;  transform: rotate(12deg);  } 
  .pos4 { left: 15%; top: 45%; --rot-orig: -6deg;  transform: rotate(-6deg);  } 
  .pos5 { left: 55%; top: 45%; --rot-orig: 6deg;   transform: rotate(6deg);   }
  
  .sobre-img { width: 100%; display: block; }

  /* MODAL / SLIDER */
  #hojaOverlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85); display: none; align-items: center; justify-content: center; z-index: 10000;
    backdrop-filter: blur(3px); 
  }
  .ventana-modal { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; }
  .contenedor-slider { width: 100%; height: 100%; overflow: hidden; }
  .galeria-slider { display: flex; height: 100%; transition: transform 0.4s ease-out; }
  .slide { min-width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; overflow-y: auto; }
  .slide img { max-width: 95%; max-height: 85vh; object-fit: contain; }
  .slide.modo-lectura { align-items: flex-start; padding: 50px 10px; }
  .slide.modo-lectura img { width: 90% !important; max-width: 800px !important; height: auto !important; box-shadow: none !important; }

  .btn-cerrar {
    position: absolute; top: 20px; right: 20px; background: #e74c3c; color: white;
    border: 2px solid white; width: 45px; height: 45px; border-radius: 50%; z-index: 10030; font-size: 22px; cursor: pointer;
  }
  .flecha {
    position: absolute; top: 50%; transform: translateY(-50%);
    background: rgba(90, 62, 43, 0.7); color: white; border: none; width: 55px; height: 55px; border-radius: 50%; z-index: 10020; font-size: 28px; cursor: pointer;
  }
  .flecha-izq { left: 15px; } .flecha-der { right: 15px; }

  .controles-musica {
    position: fixed; bottom: 20px; right: 20px; background: white; padding: 8px 15px;
    border-radius: 50px; border: 2px solid #5a3e2b; display: flex; align-items: center; gap: 10px; z-index: 1000;
  }
  .btn-musica { background: #5a3e2b; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; }

  @media (max-width: 768px) {
    .maquina-escribir { font-size: 16px; }
    .caja-regalo { height: 60vh; }
    .grupo-carta:hover { transform: scale(1.15) rotate(0deg) translateY(-15px) !important; }
  }
</style>
</head>
<body>

  <div class="contenedor-maquina">
    <div class="maquina-escribir">¬°Haz clic para tu sorpresa, Camila!‚úÆ</div>
  </div>

  <div class="caja-regalo cerrada" id="cajaPrincipal" onclick="toggleCaja()">
    <img id="imagenCaja" src="img/cajacerrada.png">
    <div class="cartas-container" id="cartas">
      <div class="grupo-carta pos1" onclick="abrirCarta(event, 1)"><img class="sobre-img" src="img/cartacerrada1-dannayfrida.png"></div>
      <div class="grupo-carta pos2" onclick="abrirCarta(event, 3)"><img class="sobre-img" src="img/cartacerrada3-delia.png"></div>
      <div class="grupo-carta pos3" onclick="abrirCarta(event, 4)"><img class="sobre-img" src="img/cartacerrada4-adan.png"></div>
      <div class="grupo-carta pos4" onclick="abrirCarta(event, 5)"><img class="sobre-img" src="img/cartacerrada5-sagrayroberto.png"></div>
      <div class="grupo-carta pos5" onclick="abrirCarta(event, 2)"><img class="sobre-img" src="img/cartacerrada2-silyabe.png"></div>
    </div>
  </div>

  <audio id="musicaFondo" src="queen.mp3" loop></audio>
  
  <div class="controles-musica">
    <span style="font-size: 10px; font-weight: bold; color: #5a3e2b;">You're My Best Friend üéµ</span>
    <button class="btn-musica" onclick="controlarMusica()" id="btnPlayPausa">‚ñ∂</button>
  </div>

  <div id="hojaOverlay">
    <div class="ventana-modal">
      <button class="btn-cerrar" onclick="cerrarHoja()">‚úï</button>
      <button class="flecha flecha-izq" onclick="mover(-1)">‚ùÆ</button>
      <button class="flecha flecha-der" onclick="mover(1)">‚ùØ</button>
      <div class="contenedor-slider">
        <div class="galeria-slider" id="galeria"></div>
      </div>
    </div>
  </div>

<script>
let index = 0;
let cajaAbierta = false;
let cartaActivaId = null;
const audio = document.getElementById("musicaFondo");
const btnMusica = document.getElementById("btnPlayPausa");

const fotos = {
  1: ['img/escritodannayfrida.png', 'img/foto1.jpg', 'img/foto2.jpg', 'img/foto3.jpg', 'img/foto4.jpg', 'img/foto5.jpg', 'img/foto6.jpg', 'img/foto7.jpg', 'img/foto8.jpg', 'img/foto9.jpg', 'img/foto10.jpg', 'img/foto11.jpg', 'img/foto12.jpg', 'img/foto13.jpg'],
  2: ['img/escritosilyabe.png', 'img/foto34.jpg', 'img/foto35.jpg', 'img/foto36.jpg', 'img/foto37.jpg', 'img/foto38.jpg', 'img/foto39.jpg', 'img/foto40.jpg'],
  3: ['img/escritodelia1.png', 'img/escritodelia2.png', 'img/foto14.jpg', 'img/foto15.jpg', 'img/foto16.jpg', 'img/foto17.jpg', 'img/foto18.jpg'],
  4: ['img/escritoadan.png', 'img/foto19.jpg', 'img/foto20.jpg', 'img/foto21.jpg', 'img/foto22.jpg'],
  5: ['img/escritosagra.png', 'img/escritoroberto.png', 'img/foto23.jpg', 'img/foto24.jpg', 'img/foto25.jpg', 'img/foto26.jpg', 'img/foto27.jpg', 'img/foto28.jpg', 'img/foto29.jpg', 'img/foto30.jpg', 'img/foto31.jpg', 'img/foto32.jpg', 'img/foto33.jpg']
};

function controlarMusica() {
  if (audio.paused) { audio.play(); btnMusica.innerText = "‚è∏"; }
  else { audio.pause(); btnMusica.innerText = "‚ñ∂"; }
}

function toggleCaja() {
  const cajaContenedor = document.getElementById("cajaPrincipal");
  const imagenCaja = document.getElementById("imagenCaja");
  const contenedorCartas = document.getElementById("cartas");

  if (!cajaAbierta) {
    cajaAbierta = true;
    cajaContenedor.classList.remove("cerrada");
    imagenCaja.src = "img/cajaabierta.png";
    contenedorCartas.style.display = "block";
    // Forzamos que el z-index de las cartas est√© por encima de la caja
    contenedorCartas.style.zIndex = "20"; 
    audio.play().catch(() => {});
    btnMusica.innerText = "‚è∏";
    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
  } else {
    cajaAbierta = false;
    cajaContenedor.classList.add("cerrada");
    imagenCaja.src = "img/cajacerrada.png";
    // Al cerrar, ocultamos instant√°neamente
    contenedorCartas.style.display = "none";
    contenedorCartas.style.zIndex = "1";
  }
}

function abrirCarta(e, id) {
  e.stopPropagation();
  cartaActivaId = id;
  index = 0;
  const galeria = document.getElementById("galeria");
  galeria.innerHTML = "";
  fotos[id].forEach(src => {
    const div = document.createElement("div");
    div.className = "slide";
    if (src.toLowerCase().includes("escrito")) div.classList.add("modo-lectura");
    div.innerHTML = `<img src="${src}">`;
    galeria.appendChild(div);
  });
  document.getElementById("hojaOverlay").style.display = "flex";
  actualizarSlider();
}

function mover(dir) {
  const lista = fotos[cartaActivaId];
  if (!lista) return;
  index = (index + dir + lista.length) % lista.length;
  actualizarSlider();
}

function actualizarSlider() {
  document.getElementById("galeria").style.transform = `translateX(-${index * 100}%)`;
}

function cerrarHoja() { document.getElementById("hojaOverlay").style.display = "none"; }
</script>
</body>
</html>
